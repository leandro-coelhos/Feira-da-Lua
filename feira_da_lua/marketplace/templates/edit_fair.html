{% extends "base.html" %}
{% load static %}

{% block title %}Editar Feira - {{ marketplace.name }}{% endblock %}

{% block content %}
<main class="home-main">
  <section class="hero-section">
    <h1 class="hero-title">Editar Feira</h1>
    <p class="hero-subtitle">Gerencie as informações da sua feira e seus produtos.</p>
    <a href="{% url 'my_fairs' %}" class="btn btn-secondary" style="margin-top: 1rem;">← Voltar para Minhas Feiras</a>
  </section>

  <section class="results-section">
    <!-- Formulário para editar a feira -->
    <div class="form-container">
      <h2>Informações da Feira</h2>
      <form method="post">
        {% csrf_token %}
        {{ marketplace_form.as_p }}
        <button type="submit" name="update_marketplace" class="btn btn-primary">Salvar Alterações da Feira</button>
      </form>
    </div>

    <hr>

    <!-- Seção de produtos -->
    <div class="products-container">
      <h2>Gerenciar Produtos</h2>

      <!-- Formulário para adicionar novo produto -->
      <div class="form-container">
        <h3>Adicionar Novo Produto</h3>
        <form method="post" enctype="multipart/form-data">
          {% csrf_token %}
          {{ product_form.as_p }}
          <button type="submit" name="create_product" class="btn btn-primary">Adicionar Produto</button>
        </form>
      </div>

      <hr>

      <!-- Lista de produtos existentes -->
      <div class="products-list">
        <h3>Seus Produtos</h3>
        {% for item in products %}
        <div class="product-card">
          <div class="product-info">
            <h4>{{ item.product.name }}</h4>
            <p>Preço: R$ {{ item.product.price }}</p>
            {% if item.photo_base64 %}
              <img src="data:image/jpeg;base64,{{ item.photo_base64 }}" alt="{{ item.product.name }}" width="100">
            {% endif %}
          </div>
          <div class="product-actions">
            <!-- Formulário para editar produto -->
            <form method="post" enctype="multipart/form-data">
              {% csrf_token %}
              <input type="hidden" name="product_id" value="{{ item.product.id }}">
              {{ item.form.as_p }}
              <button type="submit" name="update_product" class="btn btn-sm btn-primary">Salvar</button>
            </form>
            <!-- Formulário para excluir produto -->
            <form method="post">
              {% csrf_token %}
              <input type="hidden" name="product_id" value="{{ item.product.id }}">
              <button type="submit" name="delete_product" class="btn btn-sm btn-danger">Excluir</button>
            </form>
          </div>
        </div>
        {% empty %}
        <p>Você ainda não tem produtos cadastrados.</p>
        {% endfor %}
      </div>
    </div>
  </section>
</main>
{% endblock %}
